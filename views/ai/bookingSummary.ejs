<% layout('layouts/boilerplate') %>

<div class="container py-5">
  <div class="text-center mb-4">
    <h2 class="fw-bold">Event Summary</h2>
    <p class="text-muted">This is your AI-generated event plan summary.</p>
  </div>

  <div class="row justify-content-center">
    <div class="col-lg-10">

      <div class="card p-4 shadow-sm rounded-4">

        <!-- Event Details -->
        <h4 class="fw-bold mb-3 text-primary"><%= booking.eventName %></h4>

        <p class="small text-muted">
          <strong>Date:</strong>
          <%= booking.eventDate ? new Date(booking.eventDate).toLocaleDateString() : "Not set" %><br>
          <strong>City:</strong> <%= booking.city || "Not specified" %> <br>
          <strong>Guests:</strong> <%= booking.guests || 0 %>
        </p>

        <hr>

        <!-- Items with full details -->
        <% booking.items.forEach(item => { %>
          <div class="mb-4 p-3 border rounded">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5 class="fw-bold mb-1"><%= item.kind %> — <%= item.name %></h5>
                <p class="mb-1 text-muted">Price: <strong>₹<%= item.price %></strong></p>
              </div>
              <% if (item.details && item.details.contactNumber) { %>
                <div class="text-end small">
                  <p class="mb-1"><strong>Contact</strong><br><%= item.details.contactNumber %></p>
                  <% if (item.details.email) { %>
                    <p class="mb-0"><strong>Email</strong><br><%= item.details.email %></p>
                  <% } %>
                </div>
              <% } %>
            </div>

            <!-- Show specific properties depending on kind -->
            <div class="mt-3 small text-muted">
              <% if (item.kind === 'Venue') { %>
                <p class="mb-1"><strong>Address:</strong> <%= item.details.address || 'N/A' %></p>
                <p class="mb-1"><strong>Capacity:</strong> <%= item.details.capacity || 'N/A' %></p>
                <p class="mb-1"><strong>Amenities:</strong> <%= (item.details.amenities && item.details.amenities.length) ? item.details.amenities.join(', ') : 'N/A' %></p>
              <% } else if (item.kind === 'Caterer') { %>
                <p class="mb-1"><strong>Cuisine:</strong> <%= item.details.cuisineType || 'N/A' %></p>
                <p class="mb-1"><strong>Specialties:</strong> <%= (item.details.specialties && item.details.specialties.length) ? item.details.specialties.join(', ') : 'N/A' %></p>
              <% } else if (item.kind === 'Decor') { %>
                <p class="mb-1"><strong>Style:</strong> <%= item.details.style || 'N/A' %></p>
                <p class="mb-1"><strong>Services:</strong> <%= (item.details.servicesOffered && item.details.servicesOffered.length) ? item.details.servicesOffered.join(', ') : 'N/A' %></p>
                <p class="mb-1"><strong>Price Range:</strong> ₹<%= item.details.priceRange?.min || 0 %> - ₹<%= item.details.priceRange?.max || 0 %></p>
              <% } else if (item.kind === 'Photographer') { %>
                <p class="mb-1"><strong>Service Type:</strong> <%= item.details.serviceType || 'N/A' %></p>
                <p class="mb-1"><strong>Specialties:</strong> <%= (item.details.specialties && item.details.specialties.length) ? item.details.specialties.join(', ') : 'N/A' %></p>
              <% } %>

              <% if (item.details && item.details.city) { %>
                <p class="mb-0"><strong>City:</strong> <%= item.details.city %></p>
              <% } %>
            </div>
          </div>
        <% }) %>

        <!-- Total -->
        <div class="d-flex justify-content-between align-items-center px-1">
          <h5 class="fw-bold">Total Estimated Cost</h5>
          <h5 class="text-success fw-bold">₹<%= booking.totalCost %></h5>
        </div>

        <hr>

        <h5 class="fw-bold">Next Steps</h5>
        <ul class="text-muted">
          <li>Contact each vendor to confirm availability for your chosen date.</li>
          <li>Negotiate advance payment & deposit terms if required.</li>
          <li>Use AI Invitation and Scheduler tools to prepare invites & timeline.</li>
          <li>Track expenses in the Budget panel.</li>
        </ul>

        <hr>

        <!-- PDF BUTTON - safe encoding -->
        <div class="text-center mt-4">
          <form action="/ai/recommender/pdf" method="POST" target="_blank">
            <input type="hidden" name="bookingData" id="pdfData">
            <script>
              // Put booking into a JS object and encode it to avoid quotes issues
              const bookingObj = <%- JSON.stringify(booking) %>;
              document.getElementById('pdfData').value = encodeURIComponent(JSON.stringify(bookingObj));
            </script>

            <button class="btn btn-dark px-4 py-2 fw-bold rounded-pill shadow-sm" style="font-size: 1.05rem;">
              <i class="fa-solid fa-file-pdf text-danger me-2"></i> Download Premium PDF
            </button>
          </form>
        </div>

      </div>

    </div>
  </div>
</div>
