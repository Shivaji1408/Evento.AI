<% layout('layouts/boilerplate') %>

<div class="container py-4">

  <!-- ====================== HEADER ====================== -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">
      <i class="fa-solid fa-location-dot me-2"></i>Explore Venues
    </h2>

    <a href="/venues/new" class="btn btn-success shadow-sm">
      <i class="fa-solid fa-plus me-2"></i>Add New Venue
    </a>
  </div>

  <!-- ====================== FILTER BAR ====================== -->
  <form method="GET" action="/venues" class="card p-3 shadow-sm border-0 mb-4">

    <div class="row g-3">

      <!-- City -->
      <div class="col-md-4">
        <label class="form-label fw-semibold">City</label>
        <input type="text" name="city" class="form-control"
               placeholder="Enter city"
               value="<%= filters?.city || '' %>">
      </div>

      <!-- Guests -->
      <div class="col-md-4">
        <label class="form-label fw-semibold">Minimum Guests</label>
        <input type="number" name="guests" class="form-control"
               placeholder="e.g. 200"
               value="<%= filters?.guests || '' %>">
      </div>

      <!-- Date Availability -->
      <div class="col-md-4">
        <label class="form-label fw-semibold">Available On</label>
        <input type="date" name="date" class="form-control"
               value="<%= filters?.date || '' %>">
      </div>

    </div>

    <div class="mt-3 d-flex justify-content-between">
      <button class="btn btn-primary px-4">Apply Filters</button>

      <a href="/venues" class="btn btn-secondary">Reset</a>
    </div>
  </form>

  <!-- SHOW FILTER STATUS -->
  <% if (filters.city || filters.guests || filters.date) { %>
    <div class="alert alert-info small mb-4">
      <strong>Showing results for:</strong>
      <% if (filters.city) { %> City: <%= filters.city %> <% } %>
      <% if (filters.guests) { %> | Guests â‰¥ <%= filters.guests %> <% } %>
      <% if (filters.date) { %> | Available on: <%= filters.date %> <% } %>
    </div>
  <% } %>

  <!-- ====================== VENUES LIST ====================== -->
  <% if (venues && venues.length > 0) { %>
    <div class="row g-4">

      <% venues.forEach(venue => { %>
        <div class="col-lg-4 col-md-6 col-sm-12">

          <div class="card h-100 shadow-sm border-0 rounded-3 hover-zoom">

            <!-- IMAGE -->
            <% if (venue.imageUrl) { %>
              <img src="<%= venue.imageUrl %>" class="card-img-top"
                   style="height: 220px; object-fit: cover;">
            <% } else { %>
              <img src="https://via.placeholder.com/400x220?text=No+Image" class="card-img-top">
            <% } %>

            <!-- CONTENT -->
            <div class="card-body d-flex flex-column">

              <h5 class="fw-semibold text-dark"><%= venue.name %></h5>

              <p class="text-muted small">
                <i class="fa-solid fa-location-dot text-danger me-1"></i>
                <%= venue.address %>, <%= venue.city %>
              </p>

              <p class="small text-muted">
                <i class="fa-solid fa-people-group text-success me-1"></i>
                Capacity: <%= venue.capacity %>
              </p>

              <p class="fw-semibold text-primary">
                <i class="fa-solid fa-indian-rupee-sign me-1"></i>
                <%= venue.pricePerDay.toLocaleString() %> / day
              </p>

              <!-- Amenities -->
              <% if (venue.amenities?.length > 0) { %>
                <div class="mb-2">
                  <strong class="small text-secondary">Amenities:</strong>
                  <div class="d-flex flex-wrap gap-1 mt-1">
                    <% venue.amenities.forEach(a => { %>
                      <span class="badge bg-light text-dark border"><%= a %></span>
                    <% }) %>
                  </div>
                </div>
              <% } %>

              <div class="mt-auto d-flex justify-content-between pt-3 border-top">
                <a href="/venues/<%= venue._id %>" class="btn btn-outline-primary btn-sm">
                  <i class="fa-solid fa-eye me-1"></i>View Details
                </a>
              </div>

            </div>

            <div class="card-footer bg-light small text-muted">
              Added on <%= new Date(venue.createdAt).toLocaleDateString() %>
            </div>

          </div>
        </div>
      <% }) %>

    </div>

  <% } else { %>
    <!-- EMPTY -->
    <div class="text-center py-5">
      <i class="fa-solid fa-city fa-3x text-secondary mb-3"></i>
      <h5 class="text-muted">No venues match your filters.</h5>
      <a href="/venues" class="btn btn-primary mt-3">Show All</a>
    </div>
  <% } %>

</div>
