<% layout('layouts/boilerplate') %>

<!-- Import a professional classic font -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

<!-- ===== VENUE SHOW PAGE ===== -->
<div class="container-fluid py-5 bg-light min-vh-100">

  <!-- ===== DARK HEADER SECTION ===== -->
  <div class="px-5 py-5 bg-dark text-white shadow-sm rounded-0 text-center">
    <h1 class="mb-3"
      style="font-family: 'Playfair Display', serif; font-weight: 700; font-size: 3rem; letter-spacing: 1px; color: #fff;">
      <i class="fa-solid fa-building me-3 text-warning"></i>
      <%= venue.name %>
    </h1>
    <p class="mb-0 text-light opacity-75 fs-5">
      Discover every detail before you book your perfect venue.
    </p>
  </div>

  <!-- ===== MAIN GRID ===== -->
  <div class="row g-0 mt-4 px-4">

    <!-- LEFT: VENUE DETAILS -->
    <div class="col-lg-8 col-md-7 p-4">

      <!-- Venue Image -->
      <div class="mb-4">
        <% if (venue.imageUrl) { %>
          <img src="<%= venue.imageUrl %>" alt="<%= venue.name %>" class="w-100 rounded-3 shadow"
            style="height: 500px; object-fit: cover;">
        <% } else { %>
          <img src="https://via.placeholder.com/1200x500?text=No+Image+Available" alt="No image"
            class="w-100 rounded-3 shadow">
        <% } %>
      </div>

      <!-- Venue Info -->
      <div class="px-2">
        <p class="text-muted mb-3 fs-5">
          <i class="fa-solid fa-location-dot text-danger me-2"></i>
          <%= venue.address %>, <%= venue.city %>
          <% if (venue.state) { %>(<%= venue.state %>)<% } %>
        </p>

        <p class="text-muted fs-6 mb-2">
          <i class="fa-solid fa-users text-success me-2"></i>
          Capacity: <strong><%= venue.capacity %></strong> people
        </p>

        <% if (venue.pricePerDay) { %>
          <p class="fw-semibold text-primary fs-5 mb-3">
            <i class="fa-solid fa-indian-rupee-sign me-1"></i>
            <%= venue.pricePerDay.toLocaleString() %> / day
          </p>
        <% } %>

        <!-- Contact Info -->
        <div class="mb-4">
          <% if (venue.contactNumber) { %>
            <p class="mb-1 text-muted fs-6">
              <i class="fa-solid fa-phone text-success me-2"></i>
              <%= venue.contactNumber %>
            </p>
          <% } %>
          <% if (venue.email) { %>
            <p class="mb-1 text-muted fs-6">
              <i class="fa-solid fa-envelope text-primary me-2"></i>
              <%= venue.email %>
            </p>
          <% } %>
        </div>

        <!-- Amenities -->
        <% if (venue.amenities && venue.amenities.length > 0) { %>
          <div class="mb-4">
            <h4 class="fw-bold text-dark mb-3">Amenities</h4>
            <div class="d-flex flex-wrap gap-2">
              <% venue.amenities.forEach(amenity => { %>
                <span class="badge bg-light text-dark border px-3 py-2 rounded-pill shadow-sm">
                  <%= amenity %>
                </span>
              <% }) %>
            </div>
          </div>
        <% } %>

        <p class="small text-muted mt-4">
          <i class="fa-solid fa-calendar-days me-1"></i>
          Added on: <%= new Date(venue.createdAt).toLocaleDateString() %>
        </p>

        <!-- Buttons -->
        <div class="mt-4">
          <a href="/venues" class="btn btn-outline-secondary px-4">
            <i class="fa-solid fa-arrow-left me-2"></i>Back
          </a>
          <a href="/venues/<%= venue._id %>/edit" class="btn btn-warning ms-2 px-4">
            <i class="fa-solid fa-pen-to-square me-1"></i>Edit
          </a>
          <form action="/venues/<%= venue._id %>?_method=DELETE" method="POST" class="d-inline ms-2">
            <button type="submit" class="btn btn-danger px-4"
              onclick="return confirm('Are you sure you want to delete this venue?')">
              <i class="fa-solid fa-trash me-1"></i>Delete
            </button>
          </form>
        </div>

      </div>
    </div>

    <!-- RIGHT: RATING + BOOKING -->
    <div class="col-lg-4 col-md-5 bg-white border-start p-5 shadow-sm">
      <div class="sticky-top" style="top: 5rem;">


        <!-- ðŸŒŸ Dynamic Rating Display -->
        <div class="text-center mb-4">
          <h4 class="fw-bold text-dark mb-2">Customer Rating</h4>

          <% if (totalReviews > 0) { %>
            <div class="text-warning fs-3 mb-2">
              <% for (let i = 1; i <= 5; i++) { %>
                <% if (i <= Math.round(avgRating)) { %>
                  <i class="fa-solid fa-star"></i>
                <% } else { %>
                  <i class="fa-regular fa-star"></i>
                <% } %>
              <% } %>
            </div>
            <p class="text-muted small">
              <%= avgRating %> / 5 (Based on <%= totalReviews %> reviews)
            </p>
          <% } else { %>
            <p class="text-muted small">No ratings yet</p>
          <% } %>
        </div>

        <!-- BOOK NOW BUTTON -->
        <a href="/venues/<%= venue._id %>/pay"
           class="btn btn-success btn-lg px-5 shadow d-block text-center mb-4">
          <i class="fa-solid fa-calendar-check me-2"></i>Book This Venue
        </a>

        <hr>

        <!-- â­ Rating Form -->
        <div class="mb-4">
          <h5 class="fw-bold text-dark mb-3">Rate this Venue</h5>

          <form action="/venues/<%= venue._id %>/rate" method="POST">

            <!-- Name -->
            <div class="mb-3">
              <label class="form-label">Your Name</label>
              <input type="text" name="userName" required class="form-control" placeholder="John Doe">
            </div>

            <!-- Professional Clickable Stars -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Your Rating</label>

              <div class="star-rating d-flex flex-row-reverse justify-content-start">
                <input type="radio" name="stars" value="5" id="5"><label for="5">&#9733;</label>
                <input type="radio" name="stars" value="4" id="4"><label for="4">&#9733;</label>
                <input type="radio" name="stars" value="3" id="3"><label for="3">&#9733;</label>
                <input type="radio" name="stars" value="2" id="2"><label for="2">&#9733;</label>
                <input type="radio" name="stars" value="1" id="1"><label for="1">&#9733;</label>
              </div>
            </div>

            <!-- Comment -->
            <div class="mb-3">
              <label class="form-label">Comment</label>
              <textarea name="comment" rows="3" class="form-control"
                        placeholder="Share your experience..."></textarea>
            </div>

            <button class="btn btn-primary w-100">Submit Review</button>
          </form>
        </div>

        <!-- â­ Click-Star Rating CSS -->
        <style>
          .star-rating input {
            display: none;
          }
          .star-rating label {
            font-size: 2rem;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s;
            margin: 0 3px;
          }
          .star-rating input:checked ~ label {
            color: #ffcc00;
          }
          .star-rating label:hover,
          .star-rating label:hover ~ label {
            color: #ffdd66;
          }
        </style>

        <hr>

        <!-- â­ Reviews List -->
        <div id="reviews" class="mb-4">
          <h5 class="fw-bold text-dark mb-3">Customer Reviews</h5>

          <% if (ratings.length > 0) { %>
            <% ratings.forEach(r => { %>
              <div class="p-3 border rounded mb-3 bg-light">
                <div class="d-flex justify-content-between">
                  <h6 class="fw-bold mb-1"><%= r.userName %></h6>
                  <small class="text-muted"><%= new Date(r.createdAt).toLocaleDateString() %></small>
                </div>

                <div class="text-warning mb-2">
                  <% for (let i = 1; i <= 5; i++) { %>
                    <% if (i <= r.stars) { %>
                      <i class="fa-solid fa-star"></i>
                    <% } else { %>
                      <i class="fa-regular fa-star"></i>
                    <% } %>
                  <% } %>
                </div>

                <p class="text-muted small mb-2"><%= r.comment || "No comment provided." %></p>

                <!-- Delete Rating Button -->
                <form action="/venues/<%= venue._id %>/rate/<%= r._id %>?_method=DELETE"
                      method="POST"
                      onsubmit="return confirm('Are you sure you want to delete this rating?')">
                  <button class="btn btn-sm btn-outline-danger">
                    <i class="fa-solid fa-trash"></i> Delete
                  </button>
                </form>

              </div>
            <% }) %>
          <% } else { %>
            <p class="text-muted">No reviews yet.</p>
          <% } %>
        </div>

        <!-- Why Choose -->
        <div>
          <h5 class="fw-bold text-dark mb-3">Why Choose This Venue?</h5>
          <ul class="list-unstyled text-muted small">
            <li><i class="fa-solid fa-circle-check text-success me-2"></i>Spacious and elegant interiors</li>
            <li><i class="fa-solid fa-circle-check text-success me-2"></i>Great amenities and service</li>
            <li><i class="fa-solid fa-circle-check text-success me-2"></i>Ideal for weddings & corporate events</li>
          </ul>
        </div>

      </div>
    </div>

  </div>
</div>
